f_state_check = {
	every_state = { 
		set_state_flag = flagged_2
		if = {
			limit = {
				# optimisation: dont check before war is expected
				#has_global_flag = warred
				always = yes
			}
			set_variable = { global.the_state = THIS }
			set_state_flag = flagged
			for_each_loop = {
				array = THIS.core_countries
				if = {
					limit = {
						OR = {
							check_variable = {
								v = global.the_state:controller
							}
							always = yes
						}
					}
					set_state_flag = gl_2
				}
			}
			# TODO do the effects
			#set_state_category = rural
		}
	}
}